<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Login - HelpDesk</title>
  <link rel="stylesheet" href="css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet"/>
</head>

<body class="login-body">

  <div class="login-wrapper">
    <div class="login-card">

      <h1>HelpDesk</h1>
      <p id="formSubtitle">Acesse sua conta</p>

      <form id="authForm">
        <input type="email" id="email" placeholder="E-mail" required />
        <input type="password" id="password" placeholder="Senha" required />
        <button type="submit" id="submitBtn">Entrar</button>
      </form>

      <p id="toggleText">
        N√£o tem conta?
        <span id="toggleMode" style="color: #2563eb; cursor: pointer;">
          Criar conta
        </span>
      </p>

      <p id="errorMsg" style="color:red; margin-top:10px;"></p>

    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import {
    getAuth,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  // üî• SUA CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyDvBoopJzCdywnDdy52Z-iSiCahOShQkAw",
    authDomain: "helpdesk-saas-c3bcf.firebaseapp.com",
    projectId: "helpdesk-saas-c3bcf",
    storageBucket: "helpdesk-saas-c3bcf.firebasestorage.app",
    messagingSenderId: "303000323821",
    appId: "1:303000323821:web:c2aa51c9ba7a0b3372aee4",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const form = document.getElementById("authForm");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const toggleMode = document.getElementById("toggleMode");
  const formSubtitle = document.getElementById("formSubtitle");
  const submitBtn = document.getElementById("submitBtn");
  const errorMsg = document.getElementById("errorMsg");

  let modoLogin = true;

  // üîê Se j√° estiver logado ‚Üí vai pro dashboard
  onAuthStateChanged(auth, (user) => {
    if (user) {
      window.location.href = "dashboard.html";
    }
  });

  // üîÑ Alternar modo
  toggleMode.addEventListener("click", () => {
    modoLogin = !modoLogin;
    errorMsg.innerText = "";

    if (modoLogin) {
      formSubtitle.innerText = "Acesse sua conta";
      submitBtn.innerText = "Entrar";
      toggleText.innerHTML = `
        N√£o tem conta?
        <span id="toggleMode" style="color:#2563eb;cursor:pointer;">Criar conta</span>
      `;
    } else {
      formSubtitle.innerText = "Crie sua conta";
      submitBtn.innerText = "Criar conta";
      toggleText.innerHTML = `
        J√° tem conta?
        <span id="toggleMode" style="color:#2563eb;cursor:pointer;">Entrar</span>
      `;
    }

    // Reatribuir evento porque recriamos o HTML
    document.getElementById("toggleMode").addEventListener("click", arguments.callee);
  });

  // üöÄ Login ou Cadastro
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    errorMsg.innerText = "";

    const email = emailInput.value;
    const senha = passwordInput.value;

    try {
      if (modoLogin) {
        await signInWithEmailAndPassword(auth, email, senha);
      } else {
        await createUserWithEmailAndPassword(auth, email, senha);
      }

      window.location.href = "dashboard.html";

    } catch (error) {
      tratarErro(error.code);
    }
  });

  function tratarErro(code) {
    if (code === "auth/email-already-in-use")
      errorMsg.innerText = "Este e-mail j√° est√° cadastrado.";

    else if (code === "auth/invalid-email")
      errorMsg.innerText = "E-mail inv√°lido.";

    else if (code === "auth/weak-password")
      errorMsg.innerText = "Senha deve ter pelo menos 6 caracteres.";

    else if (code === "auth/user-not-found")
      errorMsg.innerText = "Usu√°rio n√£o encontrado.";

    else if (code === "auth/wrong-password")
      errorMsg.innerText = "Senha incorreta.";

    else
      errorMsg.innerText = "Erro: " + code;
  }

</script>

</body>
</html>